<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dune: Narrative Arc</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Source+Sans+Pro:wght@300;400;600&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Source Sans Pro', sans-serif;
            background: #0a0a0f;
            color: #e8e8e8;
            min-height: 100vh;
            overflow-x: hidden;
        }

        header {
            text-align: center;
            padding: 30px 20px 20px;
            background: linear-gradient(180deg, rgba(20,20,30,1) 0%, rgba(10,10,15,0) 100%);
        }

        h1 {
            font-family: 'Cinzel', serif;
            font-size: 2.8em;
            font-weight: 400;
            color: #e9c46a;
            letter-spacing: 8px;
            text-shadow: 0 0 40px rgba(233,196,106,0.3);
        }

        .subtitle {
            font-size: 1em;
            color: #6b7280;
            letter-spacing: 3px;
            margin-top: 8px;
        }

        #chart-container {
            width: 100%;
            overflow-x: auto;
            padding: 0 20px;
        }

        #chart {
            min-width: 1500px;
            height: 700px;
        }

        .book-zone {
            opacity: 0.15;
        }

        .book-label {
            font-family: 'Cinzel', serif;
            font-size: 14px;
            fill: #888;
            letter-spacing: 2px;
        }

        .character-line {
            fill: none;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
            filter: drop-shadow(0 0 3px currentColor);
        }

        .character-line.faded {
            opacity: 0.15;
            filter: none;
        }

        .character-line.hidden {
            opacity: 0;
        }

        .character-label {
            font-size: 11px;
            font-weight: 600;
            fill: #fff;
            text-shadow: 0 0 8px #000, 0 0 8px #000;
        }

        .character-label.faded {
            opacity: 0.3;
        }

        .death-marker {
            fill: #dc2626;
            filter: drop-shadow(0 0 4px #dc2626);
        }

        .event-marker {
            fill: #e9c46a;
        }

        .event-label {
            font-size: 10px;
            fill: #e9c46a;
            font-style: italic;
        }

        .timeline-axis line {
            stroke: #333;
        }

        .timeline-axis text {
            fill: #666;
            font-size: 10px;
        }

        .controls {
            padding: 20px;
            background: rgba(20,20,30,0.9);
            border-top: 1px solid #333;
            position: sticky;
            bottom: 0;
        }

        .controls-inner {
            max-width: 1200px;
            margin: 0 auto;
        }

        .control-row {
            display: flex;
            align-items: center;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .slider-container {
            flex: 1;
            max-width: 600px;
            min-width: 300px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
            color: #888;
        }

        #segment-display {
            color: #e9c46a;
            font-weight: 600;
        }

        #timeline-slider {
            width: 100%;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right,
                #e63946 0%, #e63946 47.9%,
                #2a9d8f 48%, #2a9d8f 85.4%,
                #f4a261 85.5%, #f4a261 100%);
            cursor: pointer;
        }

        #timeline-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e9c46a;
            cursor: grab;
            box-shadow: 0 0 15px rgba(233,196,106,0.6);
        }

        .btn {
            background: transparent;
            border: 1px solid #e9c46a;
            color: #e9c46a;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }

        .btn:hover {
            background: rgba(233,196,106,0.15);
        }

        .btn.active {
            background: #e9c46a;
            color: #0a0a0f;
        }

        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8em;
            color: #888;
        }

        .legend-line {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }

        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .current-event {
            text-align: center;
            margin-top: 15px;
            min-height: 24px;
        }

        .current-event-text {
            color: #e9c46a;
            font-style: italic;
            font-size: 1.1em;
        }

        .tooltip {
            position: absolute;
            background: rgba(20,20,30,0.95);
            border: 1px solid #e9c46a;
            border-radius: 6px;
            padding: 10px 14px;
            font-size: 0.85em;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.15s;
            z-index: 100;
            max-width: 200px;
        }

        .tooltip.visible { opacity: 1; }
        .tooltip-name { color: #e9c46a; font-weight: 600; margin-bottom: 4px; }
        .tooltip-info { color: #aaa; font-size: 0.9em; }
    </style>
</head>
<body>
    <header>
        <h1>DUNE</h1>
        <p class="subtitle">A NARRATIVE ARC</p>
    </header>

    <div id="chart-container">
        <svg id="chart"></svg>
    </div>

    <div class="controls">
        <div class="controls-inner">
            <div class="control-row">
                <button class="btn" id="btn-start">⏮ Start</button>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Story Progress</span>
                        <span id="segment-display">Beginning</span>
                    </div>
                    <input type="range" id="timeline-slider" min="0" max="48" value="48">
                </div>
                <button class="btn" id="btn-play">▶ Play</button>
                <button class="btn" id="btn-end">End ⏭</button>
            </div>

            <div class="legend">
                <div class="legend-item"><div class="legend-line" style="background:#e9c46a"></div> House Atreides</div>
                <div class="legend-item"><div class="legend-line" style="background:#dc2626"></div> House Harkonnen</div>
                <div class="legend-item"><div class="legend-line" style="background:#2a9d8f"></div> Fremen</div>
                <div class="legend-item"><div class="legend-line" style="background:#a855f7"></div> Bene Gesserit</div>
                <div class="legend-item"><div class="legend-line" style="background:#6366f1"></div> Imperial</div>
                <div class="legend-item"><div class="legend-dot" style="background:#dc2626"></div> Death</div>
            </div>

            <div class="current-event">
                <span class="current-event-text" id="current-event"></span>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
    // ========================================
    // CHARACTER DATA WITH NARRATIVE PATHS
    // ========================================

    const CHARACTERS = [
        // House Atreides - Golden
        {
            id: 'paul',
            name: 'Paul Atreides',
            color: '#e9c46a',
            group: 'atreides',
            // Y-positions at key segments (interpolated between)
            path: [
                {seg: 0, y: 200, label: true},   // Caladan, with family
                {seg: 5, y: 200},                 // Still on Caladan
                {seg: 8, y: 220},                 // Arriving Arrakis
                {seg: 15, y: 240},                // Before the fall
                {seg: 17, y: 320},                // The fall - scattered
                {seg: 20, y: 380},                // Fleeing into desert
                {seg: 23, y: 420},                // Joining Fremen
                {seg: 30, y: 400},                // Rising among Fremen
                {seg: 35, y: 380},                // Muad'Dib
                {seg: 41, y: 350},                // Kwisatz Haderach awakens
                {seg: 44, y: 300},                // Attack on Arrakeen
                {seg: 48, y: 200, label: true}    // Emperor
            ]
        },
        {
            id: 'jessica',
            name: 'Lady Jessica',
            color: '#c9a227',
            group: 'atreides',
            path: [
                {seg: 0, y: 220, label: true},
                {seg: 5, y: 220},
                {seg: 8, y: 240},
                {seg: 15, y: 260},
                {seg: 17, y: 340},
                {seg: 20, y: 390},
                {seg: 23, y: 430},
                {seg: 27, y: 440},                // Becomes Reverend Mother
                {seg: 35, y: 450},
                {seg: 43, y: 460},                // Captured
                {seg: 48, y: 280, label: true}
            ]
        },
        {
            id: 'leto',
            name: 'Duke Leto',
            color: '#d4a84b',
            group: 'atreides',
            deathSeg: 17,
            path: [
                {seg: 0, y: 180, label: true},
                {seg: 5, y: 180},
                {seg: 8, y: 200},
                {seg: 15, y: 220},
                {seg: 17, y: 280}                 // Death
            ]
        },
        {
            id: 'duncan',
            name: 'Duncan Idaho',
            color: '#b8942e',
            group: 'atreides',
            deathSeg: 19,
            path: [
                {seg: 0, y: 240},
                {seg: 3, y: 240, label: true},
                {seg: 8, y: 260},
                {seg: 15, y: 280},
                {seg: 17, y: 360},
                {seg: 19, y: 400}                 // Death - fighting Sardaukar
            ]
        },
        {
            id: 'gurney',
            name: 'Gurney Halleck',
            color: '#a68729',
            group: 'atreides',
            path: [
                {seg: 0, y: 260},
                {seg: 3, y: 260, label: true},
                {seg: 8, y: 280},
                {seg: 15, y: 300},
                {seg: 17, y: 380},
                {seg: 20, y: 500},                // Scattered - thought dead
                {seg: 35, y: 480},                // Survives with smugglers
                {seg: 40, y: 420},                // Reunites with Paul
                {seg: 48, y: 320, label: true}
            ]
        },
        {
            id: 'yueh',
            name: 'Dr. Yueh',
            color: '#8b7355',
            group: 'atreides',
            deathSeg: 17,
            path: [
                {seg: 0, y: 280},
                {seg: 3, y: 280, label: true},
                {seg: 8, y: 300},
                {seg: 15, y: 310},
                {seg: 17, y: 320}                 // Death - killed by Piter
            ]
        },

        // House Harkonnen - Red
        {
            id: 'baron',
            name: 'Baron Harkonnen',
            color: '#dc2626',
            group: 'harkonnen',
            deathSeg: 44,
            path: [
                {seg: 0, y: 580},
                {seg: 4, y: 580, label: true},
                {seg: 9, y: 560},
                {seg: 15, y: 520},                // Attack begins
                {seg: 17, y: 480},                // Victory
                {seg: 25, y: 540},
                {seg: 35, y: 560},
                {seg: 43, y: 500},                // Emperor arrives
                {seg: 44, y: 460}                 // Death - killed by Alia
            ]
        },
        {
            id: 'feyd',
            name: 'Feyd-Rautha',
            color: '#b91c1c',
            group: 'harkonnen',
            deathSeg: 46,
            path: [
                {seg: 0, y: 620},
                {seg: 9, y: 620, label: true},
                {seg: 20, y: 600},
                {seg: 35, y: 580},
                {seg: 43, y: 520},
                {seg: 46, y: 350}                 // Death - killed by Paul
            ]
        },
        {
            id: 'rabban',
            name: 'Beast Rabban',
            color: '#991b1b',
            group: 'harkonnen',
            path: [
                {seg: 0, y: 600},
                {seg: 9, y: 600, label: true},
                {seg: 20, y: 560},                // Rules Arrakis
                {seg: 35, y: 580},
                {seg: 40, y: 600},                // Losing control
                {seg: 44, y: 540}                 // Killed in battle
            ],
            deathSeg: 44
        },

        // Fremen - Teal
        {
            id: 'stilgar',
            name: 'Stilgar',
            color: '#2a9d8f',
            group: 'fremen',
            path: [
                {seg: 8, y: 480},
                {seg: 8, y: 480, label: true},
                {seg: 20, y: 440},
                {seg: 23, y: 410},                // Accepts Paul
                {seg: 30, y: 390},
                {seg: 40, y: 370},
                {seg: 48, y: 340, label: true}
            ]
        },
        {
            id: 'chani',
            name: 'Chani',
            color: '#14b8a6',
            group: 'fremen',
            path: [
                {seg: 23, y: 440, label: true},
                {seg: 30, y: 410},                // With Paul
                {seg: 35, y: 390},
                {seg: 40, y: 380},
                {seg: 48, y: 260, label: true}    // Paul's concubine
            ]
        },
        {
            id: 'kynes',
            name: 'Liet-Kynes',
            color: '#0d9488',
            group: 'fremen',
            deathSeg: 21,
            path: [
                {seg: 8, y: 500, label: true},
                {seg: 15, y: 480},
                {seg: 20, y: 420},                // Helps Paul escape
                {seg: 21, y: 450}                 // Death - abandoned in desert
            ]
        },

        // Bene Gesserit - Purple
        {
            id: 'mohiam',
            name: 'Rev. Mother Mohiam',
            color: '#a855f7',
            group: 'benegesserit',
            path: [
                {seg: 0, y: 140, label: true},
                {seg: 3, y: 160},                 // Tests Paul
                {seg: 10, y: 120},                // Returns to Emperor
                {seg: 43, y: 140},                // With Emperor on Arrakis
                {seg: 48, y: 160}
            ]
        },

        // Imperial - Indigo
        {
            id: 'emperor',
            name: 'Emperor Shaddam IV',
            color: '#6366f1',
            group: 'imperial',
            path: [
                {seg: 5, y: 100, label: true},
                {seg: 15, y: 100},                // Conspires with Baron
                {seg: 35, y: 100},
                {seg: 43, y: 120},                // Arrives on Arrakis
                {seg: 45, y: 180},                // Confronted by Paul
                {seg: 48, y: 240}                 // Deposed
            ]
        },
        {
            id: 'irulan',
            name: 'Princess Irulan',
            color: '#818cf8',
            group: 'imperial',
            path: [
                {seg: 43, y: 140, label: true},
                {seg: 47, y: 200},
                {seg: 48, y: 220, label: true}    // Marries Paul
            ]
        },

        // Alia
        {
            id: 'alia',
            name: 'Alia',
            color: '#fbbf24',
            group: 'atreides',
            path: [
                {seg: 28, y: 460, label: true},   // Born
                {seg: 35, y: 470},
                {seg: 43, y: 480},                // Captured
                {seg: 44, y: 440},                // Kills Baron
                {seg: 48, y: 300}
            ]
        }
    ];

    // Key story events
    const EVENTS = [
        {seg: 0, y: 60, text: "Caladan: The Atreides prepare to leave"},
        {seg: 1, y: 60, text: "Paul tested with the Gom Jabbar"},
        {seg: 8, y: 60, text: "Arrival on Arrakis"},
        {seg: 15, y: 60, text: "Harkonnen attack begins"},
        {seg: 17, y: 60, text: "The Fall: Duke Leto dies"},
        {seg: 19, y: 60, text: "Duncan's last stand"},
        {seg: 23, y: 60, text: "Paul & Jessica join the Fremen"},
        {seg: 27, y: 60, text: "Jessica becomes Reverend Mother"},
        {seg: 30, y: 60, text: "Paul and Chani"},
        {seg: 35, y: 60, text: "Paul foresees the Jihad"},
        {seg: 41, y: 60, text: "Paul drinks the Water of Life"},
        {seg: 44, y: 60, text: "Battle of Arrakeen: Alia kills Baron"},
        {seg: 46, y: 60, text: "Paul kills Feyd-Rautha"},
        {seg: 47, y: 60, text: "Paul becomes Emperor"},
    ];

    // ========================================
    // VISUALIZATION
    // ========================================

    const margin = {top: 80, right: 150, bottom: 40, left: 180};
    const width = 1400;
    const height = 700;
    const innerWidth = width - margin.left - margin.right;
    const innerHeight = height - margin.top - margin.bottom;

    const svg = d3.select('#chart')
        .attr('viewBox', `0 0 ${width} ${height}`)
        .attr('preserveAspectRatio', 'xMidYMid meet');

    const g = svg.append('g')
        .attr('transform', `translate(${margin.left},${margin.top})`);

    // Scales
    const xScale = d3.scaleLinear()
        .domain([0, 48])
        .range([0, innerWidth]);

    const yScale = d3.scaleLinear()
        .domain([0, 700])
        .range([0, innerHeight]);

    // Book zones
    const bookZones = [
        {start: 0, end: 22, color: '#e63946', label: 'BOOK I: DUNE'},
        {start: 23, end: 40, color: '#2a9d8f', label: 'BOOK II: MUAD\'DIB'},
        {start: 41, end: 48, color: '#f4a261', label: 'BOOK III: THE PROPHET'}
    ];

    g.selectAll('.book-zone')
        .data(bookZones)
        .join('rect')
        .attr('class', 'book-zone')
        .attr('x', d => xScale(d.start))
        .attr('y', 0)
        .attr('width', d => xScale(d.end) - xScale(d.start))
        .attr('height', innerHeight)
        .attr('fill', d => d.color);

    g.selectAll('.book-label')
        .data(bookZones)
        .join('text')
        .attr('class', 'book-label')
        .attr('x', d => xScale((d.start + d.end) / 2))
        .attr('y', -10)
        .attr('text-anchor', 'middle')
        .text(d => d.label);

    // Line generator with smooth curves
    const lineGenerator = d3.line()
        .x(d => xScale(d.seg))
        .y(d => yScale(d.y))
        .curve(d3.curveCatmullRom.alpha(0.5));

    // Draw character paths
    const characterPaths = g.append('g').attr('class', 'character-paths');

    CHARACTERS.forEach(char => {
        // Main path
        characterPaths.append('path')
            .datum(char)
            .attr('class', 'character-line')
            .attr('id', `path-${char.id}`)
            .attr('d', lineGenerator(char.path))
            .attr('stroke', char.color)
            .style('stroke-dasharray', function() {
                return this.getTotalLength();
            })
            .style('stroke-dashoffset', 0);

        // Death marker
        if (char.deathSeg) {
            const deathPoint = char.path.find(p => p.seg === char.deathSeg);
            if (deathPoint) {
                characterPaths.append('circle')
                    .attr('class', 'death-marker')
                    .attr('id', `death-${char.id}`)
                    .attr('cx', xScale(char.deathSeg))
                    .attr('cy', yScale(deathPoint.y))
                    .attr('r', 6);

                characterPaths.append('line')
                    .attr('class', 'death-marker')
                    .attr('id', `deathx-${char.id}`)
                    .attr('x1', xScale(char.deathSeg) - 4)
                    .attr('y1', yScale(deathPoint.y) - 4)
                    .attr('x2', xScale(char.deathSeg) + 4)
                    .attr('y2', yScale(deathPoint.y) + 4)
                    .attr('stroke', '#fff')
                    .attr('stroke-width', 2);

                characterPaths.append('line')
                    .attr('class', 'death-marker')
                    .attr('id', `deathx2-${char.id}`)
                    .attr('x1', xScale(char.deathSeg) + 4)
                    .attr('y1', yScale(deathPoint.y) - 4)
                    .attr('x2', xScale(char.deathSeg) - 4)
                    .attr('y2', yScale(deathPoint.y) + 4)
                    .attr('stroke', '#fff')
                    .attr('stroke-width', 2);
            }
        }

        // Labels at key points
        char.path.filter(p => p.label).forEach(p => {
            characterPaths.append('text')
                .attr('class', 'character-label')
                .attr('id', `label-${char.id}-${p.seg}`)
                .attr('x', xScale(p.seg) + 8)
                .attr('y', yScale(p.y) + 4)
                .attr('text-anchor', 'start')
                .attr('fill', char.color)
                .text(char.name);
        });
    });

    // Event markers
    const eventMarkers = g.append('g').attr('class', 'event-markers');

    EVENTS.forEach(evt => {
        eventMarkers.append('line')
            .attr('class', 'event-line')
            .attr('id', `evt-line-${evt.seg}`)
            .attr('x1', xScale(evt.seg))
            .attr('y1', yScale(evt.y))
            .attr('x2', xScale(evt.seg))
            .attr('y2', innerHeight)
            .attr('stroke', '#e9c46a')
            .attr('stroke-width', 1)
            .attr('stroke-dasharray', '3,3')
            .attr('opacity', 0.3);
    });

    // Playhead
    const playhead = g.append('line')
        .attr('id', 'playhead')
        .attr('x1', xScale(48))
        .attr('y1', 0)
        .attr('x2', xScale(48))
        .attr('y2', innerHeight)
        .attr('stroke', '#e9c46a')
        .attr('stroke-width', 2)
        .attr('opacity', 0);

    // ========================================
    // INTERACTIVITY
    // ========================================

    let currentSeg = 48;
    let isPlaying = false;
    let playInterval = null;

    function updateVisualization(seg) {
        currentSeg = seg;

        // Update playhead position
        playhead
            .attr('x1', xScale(seg))
            .attr('x2', xScale(seg))
            .attr('opacity', seg < 48 ? 0.8 : 0);

        // Update character paths - clip based on segment
        CHARACTERS.forEach(char => {
            const path = d3.select(`#path-${char.id}`);
            const pathNode = path.node();
            const totalLength = pathNode.getTotalLength();

            // Find the position along the path for this segment
            const lastVisiblePoint = char.path.filter(p => p.seg <= seg).pop();
            const firstHiddenPoint = char.path.find(p => p.seg > seg);

            if (!lastVisiblePoint) {
                // Character hasn't appeared yet
                path.style('stroke-dashoffset', totalLength);
                path.classed('hidden', true);
            } else {
                path.classed('hidden', false);

                // Calculate approximate length to show
                let ratio = 0;
                if (firstHiddenPoint) {
                    const visiblePoints = char.path.filter(p => p.seg <= seg);
                    const totalPoints = char.path.length;
                    ratio = visiblePoints.length / totalPoints;
                } else {
                    ratio = 1;
                }

                // Handle death - fade after death
                if (char.deathSeg && seg > char.deathSeg) {
                    path.classed('faded', true);
                } else {
                    path.classed('faded', false);
                }

                const visibleLength = totalLength * ratio;
                path.style('stroke-dashoffset', totalLength - visibleLength);
            }

            // Labels
            char.path.filter(p => p.label).forEach(p => {
                const label = d3.select(`#label-${char.id}-${p.seg}`);
                if (p.seg <= seg) {
                    label.attr('opacity', 1);
                    if (char.deathSeg && seg > char.deathSeg) {
                        label.classed('faded', true);
                    } else {
                        label.classed('faded', false);
                    }
                } else {
                    label.attr('opacity', 0);
                }
            });

            // Death markers
            if (char.deathSeg) {
                const show = seg >= char.deathSeg;
                d3.select(`#death-${char.id}`).attr('opacity', show ? 1 : 0);
                d3.select(`#deathx-${char.id}`).attr('opacity', show ? 1 : 0);
                d3.select(`#deathx2-${char.id}`).attr('opacity', show ? 1 : 0);
            }
        });

        // Update event lines
        EVENTS.forEach(evt => {
            d3.select(`#evt-line-${evt.seg}`)
                .attr('opacity', seg >= evt.seg ? 0.3 : 0);
        });

        // Update UI
        const segmentDisplay = document.getElementById('segment-display');
        if (seg === 0) {
            segmentDisplay.textContent = 'Beginning';
        } else if (seg === 48) {
            segmentDisplay.textContent = 'Complete';
        } else {
            const book = seg < 23 ? 'I' : seg < 41 ? 'II' : 'III';
            segmentDisplay.textContent = `Book ${book} · Segment ${seg}`;
        }

        // Current event
        const currentEvent = [...EVENTS].reverse().find(e => e.seg <= seg);
        document.getElementById('current-event').textContent =
            currentEvent ? currentEvent.text : '';
    }

    // Controls
    const slider = document.getElementById('timeline-slider');
    slider.addEventListener('input', () => {
        updateVisualization(parseInt(slider.value));
    });

    document.getElementById('btn-start').onclick = () => {
        stopPlay();
        slider.value = 0;
        updateVisualization(0);
    };

    document.getElementById('btn-end').onclick = () => {
        stopPlay();
        slider.value = 48;
        updateVisualization(48);
    };

    document.getElementById('btn-play').onclick = togglePlay;

    function togglePlay() {
        if (isPlaying) {
            stopPlay();
        } else {
            startPlay();
        }
    }

    function startPlay() {
        isPlaying = true;
        document.getElementById('btn-play').textContent = '⏸ Pause';
        document.getElementById('btn-play').classList.add('active');

        if (parseInt(slider.value) >= 48) {
            slider.value = 0;
            updateVisualization(0);
        }

        playInterval = setInterval(() => {
            const current = parseInt(slider.value);
            if (current < 48) {
                slider.value = current + 1;
                updateVisualization(current + 1);
            } else {
                stopPlay();
            }
        }, 400);
    }

    function stopPlay() {
        isPlaying = false;
        document.getElementById('btn-play').textContent = '▶ Play';
        document.getElementById('btn-play').classList.remove('active');
        if (playInterval) {
            clearInterval(playInterval);
            playInterval = null;
        }
    }

    // Tooltip for hovering on paths
    const tooltip = document.getElementById('tooltip');

    d3.selectAll('.character-line')
        .on('mouseover', function(event, d) {
            tooltip.innerHTML = `
                <div class="tooltip-name">${d.name}</div>
                <div class="tooltip-info">${d.deathSeg ? `Dies at segment ${d.deathSeg}` : 'Survives'}</div>
            `;
            tooltip.style.left = (event.pageX + 10) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';
            tooltip.classList.add('visible');

            // Highlight this line
            d3.selectAll('.character-line').classed('faded', true);
            d3.select(this).classed('faded', false);
        })
        .on('mouseout', function() {
            tooltip.classList.remove('visible');
            updateVisualization(currentSeg); // Reset fading
        });

    // Initialize
    updateVisualization(48);
    </script>
</body>
</html>
